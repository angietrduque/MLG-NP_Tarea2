---
title: 'Tarea 2: Modelos lineales generalizados y paramétricos'
author: "Angie Rodriguez Duque & Cesar Saavedra Vanegas"
date: "Octubre 22 de 2020"
output: pdf_document
---
```{r warning=FALSE, include=F, paged.print=TRUE}
suppressMessages(library(dplyr))
suppressMessages(library(readxl))
suppressMessages(library(tidyverse))
suppressMessages(library(FactoMineR))
suppressMessages(library(factoextra))
suppressMessages(library(foreign))
suppressMessages(library(corrplot))
suppressMessages(library(polycor))
suppressMessages(library(psych))
suppressMessages(library(gplots))
suppressMessages(library(gridExtra))
suppressMessages(library(viridis))
suppressMessages(library(lsr))
suppressMessages(library(DescTools))
suppressMessages(library(magrittr))
suppressMessages(library(nlme))
suppressMessages(library(MASS))
suppressMessages(library(multilevel))
suppressMessages(library(plspm))
suppressMessages(library(reshape))
suppressMessages(library(homals))
suppressMessages(library(GGally))
suppressMessages(library(CCA))
suppressMessages(library(plotly))
suppressMessages(library(broom))
suppressMessages(library(readr))
suppressMessages(library(readxl))
```

# Actividad 1

## 

Se dispone de los tiempos de vida (tiempos hasta que fallan, en horas) de $49$ recipientes de presión sometidos a un nivel de carga del $70\%$

## Distribución Weibull

Para estudiar este tipo de variable se acostumbra utilizar la distribución de Weibull, cuya función de densidad es:

$$f(y;\lambda,\theta)=\displaystyle\frac{\lambda y^{\lambda-1}}{\theta^{\lambda}}exp \left[-\left(\frac{y}{\theta}\right)^{\lambda}\right] $$

# Actividad 2

## Base de datos 

```{r warning=FALSE, include=F, paged.print=TRUE}
Datos <- read.table("Datos.txt",header=T,sep = ",")
Datos
```

```{r warning=FALSE, include=T, paged.print=TRUE}
dim(Datos)
```

Este conjunto de datos de vino tinto consta de 1599 observaciones y 12 variables, 11 de las cuales son sustancias químicas. Las variables son:

<div style="text-align: justify">

1. **Acidez fija:** La mayoría de los ácidos implicados en el vino son fijos o no volátiles (no se evaporan fácilmente).

2. **Acidez volátil:** La cantidad de ácido acético en el vino, que en niveles demasiado altos puede provocar un sabor desagradable a vinagre.

3. **Ácido cítrico:** Encontrado en pequeñas cantidades, el ácido cítrico puede agregar "frescura" y sabor a los vinos.

4. **Azúcar residual:** Es la cantidad de azúcar que queda después de que se detiene la fermentación, es raro encontrar vinos con menos de 1 gramo / litro y los vinos con más de 45 gramos / litro se consideran dulces.

5. **Cloruros:** Es la cantidad de sal del vino.

6. **Dióxido de azufre libre:** La forma libre de $SO_{2}$ existe en equilibrio entre el $SO_{2}$ molecular (como gas disuelto) y el ion bisulfito; Previene el crecimiento microbiano y la oxidación del vino.

7. **Dióxido de azufre total:** Es la cantidad de formas libres y unidas de $SO_{2}$; en concentraciones bajas, el $SO_{2}$ es mayormente indetectable en el vino, pero en concentraciones de $SO_{2}$ libre superiores a 50 ppm, el $SO_{2}$ se hace evidente en la nariz y el sabor del vino.

8. **Densidad:** La densidad es cercana a la del agua dependiendo del porcentaje de alcohol y contenido de azúcar.

9. **pH:** Describe qué tan ácido o básico es un vino en una escala de 0 (muy ácido) a 14 (muy básico); la mayoría de los vinos están entre 3-4 en la escala de pH.

10. **Sulfatos:** Aditivo del vino que puede contribuir a los niveles de dióxido de azufre $(SO_{2})$, que actúa como antimicrobiano y antioxidante.

11. **Alcohol:** El porcentaje de contenido de alcohol del vino.

12. **Calidad:** Variable de respuesta (basada en datos sensoriales, puntuación entre 0 y 10).

<div/>


## Estadísticas descriptivas

```{r warning=FALSE, include=T, paged.print=TRUE}
summary(Datos)
```

<center>
![Distribución de las variables](G1.png "Regresión local"){width=650px}

### Observaciones:

* Algunas de las variables tienen distribuciones normales (densidad, acidez fija, pH, acidez volátil).

* Algunas variables están un poco sesgadas hacia el extremo inferior de los valores (cloruros, ácido cítrico, azúcar residual, dióxido de azufre total).

* La variable calidad tiene solo 6 valores discretos.

```{r warning=FALSE, include=F, paged.print=TRUE}
G2 <- ggplot(Datos, aes(group = cut_width(quality, 1)))+ 
  geom_boxplot(aes(quality, fixed.acidity), colour = "#417b5a")+
  xlab("Calidad")+ylab("Acidez fija")
```

```{r fig.align="center", fig.height=3, fig.width=8, warning=FALSE, include=F}
G2
```


```{r fig.align="center", fig.height=5, fig.width=10, warning=FALSE, include=T}
corrplot(cor(Datos), method = "square")
```

* La densidad tiene una correlación muy fuerte con la acidez fija.

* Las variables más fuertemente correlacionadas con la calidad son la acidez volátil y el alcohol.

* El alcohol tiene una correlación negativa con la densidad. Esto es evidente por el hecho de que la densidad del agua es mayor que la densidad del alcohol.

## Variable indicadora: pHi 

Se hace necesario crear una variable indicadora partiendo de los valores presentados por $pH$, esta variable indicadora cuenta con tres niveles los cuales son, bajo, medio, alto.

A partir de la siguiente figura es posible observar como el nivel de $pH$ con mayor frecuencia es aquel que se denomina como "medio" con 1417 observaciones, mientras que los niveles "bajo" y "alto", presentan frecuencias muy bajas, esto es, 134 y 48 respectivamente.

```{r warning=FALSE, include=F, paged.print=TRUE}
summary(Datos[,"pH"])
rango = (max(Datos$pH)-min(Datos$pH))/3
a = min(Datos$pH); a
b = a + rango; b
c = b + rango; c
d = c + rango; d
pHi <- vector() 
pHi[Datos$pH < b] <- "Bajo"
pHi[Datos$pH >= b & Datos$pH < c] <- "Medio"
pHi[Datos$pH > c] <- "Alto"
pHi <- as.factor(pHi)
```

```{r warning=FALSE, include=T, paged.print=TRUE}
table(pHi)

```

```{r warning=FALSE, include=F, paged.print=TRUE}
G3 <- ggplot(data = Datos, aes(x=pHi, fill=pHi)) +
  geom_bar(position="dodge") + ylab("") + xlab(" ") +
  scale_fill_discrete(name = "Nivel pH:")
```

```{r fig.align="center", fig.height=2, fig.width=5, warning=FALSE, include=T}
G3
```

## Modelo lineal generalizado (GLM)

En esta sección, se ajusta un modelo lineal generalizado usando como respuesta la variable "calidad" (quality) y como variables de predicción las variables "acidez fija" (fixed acidity) y "pHi", tal como sigue:

```{r warning=FALSE, include=T, paged.print=TRUE}
Modelo <- glm(Datos$quality ~ Datos$fixed.acidity + pHi, data=Datos)
summary(Modelo)

```


## Modelo sin variable indicadora pHi
$$Calidad=5.15732+0.05754*Acidezfija $$
<table> 
| Coeficientes 	| Estimación 	| Error estándar 	| Valor t 	|   $Pr(>|t|)$ 	| Significancia 	|
|:------------:	|:----------:	|:--------------:	|:-------:	|:------------:	|:-------------:	|
| Intercepto   	|    5.15732 	|        0.09789 	|  52.684 	|      < 2e-16 	|      ***      	|
| Acidez fija  	|    0.05754 	|        0.01152 	|   4.996 	|      6.5e-07 	|      ***      	|

## Modelo con variable indicadora pHi

$$Calidad=5.03884+0.07194*Acidezfija-0.11957*pHiBajo+0.02348*pHiMedio $$
<table>
| Coeficientes 	| Estimación 	| Error estándar 	| Valor t 	|   $Pr(>|t|)$ 	| Significancia 	|
|:------------:	|:----------:	|:--------------:	|:-------:	|:------------:	|:-------------:	|
| Intercepto   	|    5.03884 	|        0.13061 	|  38.579 	|  < 2e-16 *** 	|      ***      	|
| Acidez fija  	|    0.07194 	|        0.01365 	|   5.272 	|     1.54e-07 	|      ***      	|
| pHiBajo      	|   -0.11957 	|        0.12566 	|  -0.952 	|        0.341 	|               	|
| pHiMedio     	|    0.02348 	|        0.10672 	|   0.220 	|        0.826 	|               	|


# Conlusiones

# Biblíografia 